@page "/manage-users"
@using Application.DTOs
@using WebUI.Services
@inject UserManagementService UserManagementService
@inject AuthService AuthService
@inject ISnackbar Snackbar
@inject IDialogService DialogService
@attribute [Authorize(Roles = "Admin,admin")]

<PageTitle>User Managment</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudStack Spacing="3">
        <!-- Header -->
        <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-4">
            <MudText Typo="Typo.h5" Class="fw-bold">User Managment</MudText>
            <MudSpacer />
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="OpenAddUserDialog" StartIcon="@Icons.Material.Filled.PersonAdd">
                Create New User
            </MudButton>
        </MudStack>

        <!-- Loading State -->
        @if (isLoading)
        {
            <MudProgressCircular Indeterminate="true" />
        }
        else if (users == null || users.Count == 0)
        {
            <MudAlert Severity="Severity.Info">No Existing Users</MudAlert>
        }
        else
        {
            <!-- Users Table -->
            <MudPaper Elevation="1">
                <MudTable Height="630px"
                    FixedHeader="true"
                    Items="@users" Hover="true" Striped="true" Dense="false">
                    <HeaderContent>
                        <MudTh>Username</MudTh>
                        <MudTh>Full Name</MudTh>
                        <MudTh>Position</MudTh>
                        <MudTh Style="text-align: right;">Action</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Username">
                            <MudText>@context.Username</MudText>
                        </MudTd>
                        <MudTd DataLabel="FullName">
                            <MudText>@context.FullName</MudText>
                        </MudTd>
                        <MudTd DataLabel="Position">
                            <MudChip T="string" Size="Size.Small" Color="@GetPositionColor(context.Position)">
                                @context.Position
                            </MudChip>
                        </MudTd>
                        <MudTd DataLabel="Action" Style="text-align: right;">
                            <MudStack Row="true" Spacing="1">
                                <MudIconButton Icon="@Icons.Material.Filled.Key" Color="Color.Warning" Size="Size.Small" 
                                               OnClick="@(() => OpenChangePasswordDialog(context.Id))" title="Change Password" />
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small" 
                                               OnClick="@(() => DeleteUserConfirm(context.Id,context.Username))" title="Delete User" />
                            </MudStack>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        }
    </MudStack>
</MudContainer>


